# üî¥ –ê–Ω–∞–ª–∏–∑ –ø–∞–¥–µ–Ω–∏—è workflow - JH Workflow Recreate

**–î–∞—Ç–∞**: 22 –¥–µ–∫–∞–±—Ä—è 2024  
**Workflow**: JH Workflow Recreate  
**URL**: https://github.com/jethome-iot/armbian-os/actions/runs/20427702700

---

## ‚ùå –û—à–∏–±–∫–∞

```
error: Your local changes to the following files would be overwritten by checkout:
	.github/workflows/jh-nightly-artifact-image-complete-matrix.yml
	.github/workflows/jh-stable-artifact-image-complete-matrix.yml
Please commit your changes or stash them before you switch branches.
Aborting
Error: Process completed with exit code 1.
```

---

## üîç –ü—Ä–∏—á–∏–Ω–∞

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π** –≤ workflow:

### ‚ùå –ë—ã–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):

1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è workflow —Ñ–∞–π–ª–æ–≤ ‚Üí —Å–æ–∑–¥–∞—é—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
2. –ü–æ–ø—ã—Ç–∫–∞ checkout —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –≤–µ—Ç–∫–∏ ‚Üí **–ü–ê–î–ê–ï–¢**
3. Git –æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, —Ç.–∫. uncommitted changes –±—É–¥—É—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω—ã

### –ü–æ—á–µ–º—É –ø–∞–¥–∞–µ—Ç:

- Workflow –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã –≤ —à–∞–≥–∞—Ö 5-6
- –ó–∞—Ç–µ–º –ø—ã—Ç–∞–µ—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å `git checkout` –≤ —à–∞–≥–µ 8
- Git –≤–∏–¥–∏—Ç uncommitted changes –∏ –æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å –≤–µ—Ç–∫—É
- –û—à–∏–±–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **—Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –≤–µ—Ç–∫–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç** (–≤—Ç–æ—Ä–æ–π –∑–∞–ø—É—Å–∫ –≤ —Ç–æ—Ç –∂–µ –¥–µ–Ω—å)

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

**–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å checkout –≤–µ—Ç–∫–∏ –ü–ï–†–ï–î –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Ñ–∞–π–ª–æ–≤!**

### ‚úÖ –°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):

1. **Checkout or create feature branch** ‚Üê –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ —Å—é–¥–∞
2. Sync userpatches
3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è STABLE workflow
4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è NIGHTLY workflow  
5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
6. –ö–æ–º–º–∏—Ç –∏ push –∏–∑–º–µ–Ω–µ–Ω–∏–π
7. –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ PR

---

## üìù –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –§–∞–π–ª: `.github/workflows/jh-workflow-recreate.yaml`

**1. –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —à–∞–≥ –ø–æ—Å–ª–µ "Configure Git"**:

```yaml
- name: Checkout or create feature branch
  id: branch-setup
  run: |
    cd os
    BRANCH_NAME="automated/update-gha-workflows-$(date +%Y%m%d)"
    echo "branch_name=$BRANCH_NAME" >> $GITHUB_OUTPUT
    
    if git ls-remote --heads origin "$BRANCH_NAME" | grep -q "$BRANCH_NAME"; then
      git fetch origin "$BRANCH_NAME"
      git checkout "$BRANCH_NAME"
      git pull origin "$BRANCH_NAME"
    else
      git checkout -b "$BRANCH_NAME"
    fi
```

**2. –†–∞–∑–¥–µ–ª–µ–Ω —à–∞–≥ "Create/Update Pull Request"**:
- "Commit and push changes" - git –æ–ø–µ—Ä–∞—Ü–∏–∏
- "Create/Update Pull Request" - —Å–æ–∑–¥–∞–Ω–∏–µ PR —á–µ—Ä–µ–∑ gh CLI

**3. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è branch_name –∏–∑ output**:
```yaml
BRANCH_NAME="${{ steps.branch-setup.outputs.branch_name }}"
```

---

## üéØ –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. ‚úÖ **–í–µ—Ç–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –ü–ï–†–í–û–ô** - –¥–æ –ª—é–±—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ñ–∞–π–ª–æ–≤
2. ‚úÖ **–§–∞–π–ª—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ü–û–°–õ–ï checkout** - –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ä–∞–∑—É –Ω–∞ –Ω—É–∂–Ω–æ–π –≤–µ—Ç–∫–µ
3. ‚úÖ **–ù–µ—Ç uncommitted changes –ø—Ä–∏ checkout** - Git –Ω–µ —Ä—É–≥–∞–µ—Ç—Å—è
4. ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –∏ –¥–ª—è –Ω–æ–≤—ã—Ö, –∏ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≤–µ—Ç–æ–∫**

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å workflow
gh workflow run "JH Workflow Recreate" --ref bugfix/workflow-recreate-checkout-conflict

# –°–ª–µ–¥–∏—Ç—å –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
gh run watch

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ PR —Å–æ–∑–¥–∞–ª—Å—è
gh pr list
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

- ‚úÖ Workflow –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –í–µ—Ç–∫–∞ `automated/update-gha-workflows-YYYYMMDD` —Å–æ–∑–¥–∞–Ω–∞/–æ–±–Ω–æ–≤–ª–µ–Ω–∞
- ‚úÖ Pull Request —Å–æ–∑–¥–∞–Ω –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω
- ‚úÖ Workflow —Ñ–∞–π–ª—ã —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤

---

## üìä –°—Ç–∞—Ç—É—Å

- ‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ –Ω–∞–π–¥–µ–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ**: Checkout –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω –¥–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- ‚úÖ **–ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ feature branch
- ‚è≥ **–û–∂–∏–¥–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏**: –ù—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å workflow –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

```
.github/workflows/jh-workflow-recreate.yaml  - –æ—Å–Ω–æ–≤–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
WORKFLOW-FAILURE-ANALYSIS.md                 - –ø–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (English)
–ö–†–ê–¢–ö–ê–Ø-–°–í–û–î–ö–ê-–ü–†–û–ë–õ–ï–ú–´.md                  - –∫—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ (Russian)
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç workflow "JH Workflow Recreate"**:

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç GitHub Actions workflows –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–¥—É–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É chunks –∏–∑ `userpatches-jethub/gha/chunks/`
- –°–æ–∑–¥–∞–µ—Ç –¥–≤–∞ workflow: STABLE –∏ NIGHTLY
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç PR —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏

**–ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**:

- –ö–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 3:00 UTC
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —à–∞–±–ª–æ–Ω–æ–≤ –≤ `userpatches-jethub/gha/**`
- –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ workflow_dispatch

---

**–ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω**: 22 –¥–µ–∫–∞–±—Ä—è 2024  
**–°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é  
**Feature branch**: `bugfix/workflow-recreate-checkout-conflict`
